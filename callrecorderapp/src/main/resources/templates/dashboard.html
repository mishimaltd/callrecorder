<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <div th:replace="fragments/template.html :: header"></div>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css"/>
</head>

<body>

<!-- Navigation -->
<div th:replace="fragments/template.html :: navigation"></div>

<section class="main-body">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <table id="calls" class="table table-striped table-bordered" style="width:100%">
          <thead>
          <tr>
            <th>Date</th>
            <th>To</th>
            <th>Cost</th>
            <th>Action</th>
          </tr>
          </thead>
        </table>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<div th:replace="fragments/template.html :: footer"></div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>

<script type="text/javascript">
  $(document).ready(function() {
    var table = $('#calls').DataTable({
      "ajax": "/api/callservice/calls",
      "columns": [
        { "data": "created",
          "className": "dt-center",
          "render": function(data, type, row, meta) {
            return new Date(data).toLocaleDateString('en-US', {
              day: 'numeric',
              month: 'short',
              year: 'numeric'
            });
          }
        },
        { "data": "to" },
        { "data": "costInCents",
          "render": function(data, type, row, meta) {
            return '$' + (data/100).toFixed(2);
          }
        },
        { "data": "s3recordingUrl",
          "render": function(data, type, row, meta) {
            if( data && data != null ) {
              return "<button class='btn btn-sm btn-primary'>Download</button>"
            } else {
              return "";
            }
          }
        }
       ]
    });

    // Download recording
    $('#calls tbody').on( 'click', 'button', function () {
      var data = table.row( $(this).parents('tr')).data();
      var recordingUrl = data['sid'];
      window.open('/api/callservice/recording/' + recordingUrl);
    });

  });
</script>

</body>
</html>